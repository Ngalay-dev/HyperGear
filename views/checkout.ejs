<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Checkout</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function togglePaymentFields() {
      const method = document.querySelector('input[name="paymentMethod"]:checked')?.value;
      document.getElementById('creditCardFields').style.display = method === 'Credit/Debit Card' ? 'block' : 'none';
      document.getElementById('paynowFields').style.display = method === 'PayNow' ? 'block' : 'none';
    }
  </script>
</head>
<body class="bg-light">

<div class="container py-5">

  <!-- Header -->
  <div class="text-center mb-4">
    <h2 class="fw-bold">üõí Checkout</h2>
    <p class="text-muted">Hello, <%= user.username %>. Review your items and choose a payment method.</p>
  </div>

  <!-- CART ITEMS TABLE -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-primary text-white fw-semibold">Your Cart</div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Item</th>
              <th class="text-center">Qty</th>
              <th class="text-end">Price</th>
            </tr>
          </thead>
          <tbody>
            <% cart.forEach(item => { %>
              <tr>
                <td><%= item.productName %></td>
                <td class="text-center"><%= item.quantity %></td>
                <td class="text-end">$<%= item.price %></td>
              </tr>
            <% }) %>
            <tr class="table-secondary fw-bold">
              <td colspan="2" class="text-end">Total:</td>
              <td class="text-end">$<%= total %></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- PAYMENT FORM -->
  <form action="/checkout" method="POST">
    <div class="card shadow-sm">
      <div class="card-header bg-success text-white fw-semibold">Payment Method</div>
      <div class="card-body">

        <!-- Payment Options -->
        <div class="form-check">
          <input class="form-check-input" type="radio" name="paymentMethod" id="creditCard" value="Credit/Debit Card" onclick="togglePaymentFields()" required>
          <label class="form-check-label" for="creditCard">Credit/Debit Card</label>
        </div>

        <div class="form-check">
          <input class="form-check-input" type="radio" name="paymentMethod" id="paynow" value="PayNow" onclick="togglePaymentFields()">
          <label class="form-check-label" for="paynow">PayNow</label>
        </div>

        <div class="form-check mb-3">
          <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="Cash on Delivery" onclick="togglePaymentFields()">
          <label class="form-check-label" for="cod">Cash on Delivery</label>
        </div>

        <!-- Credit Card Fields -->
        <div id="creditCardFields" style="display:none;">
          <h6 class="mt-3 mb-2 text-muted">Card Details</h6>
          <div class="mb-3">
            <label class="form-label">Card Number</label>
            <input type="text" name="cardNumber" class="form-control" placeholder="1234 5678 9012 3456">
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Expiry Date</label>
              <input type="text" name="expiry" class="form-control" placeholder="MM/YY">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">CVV</label>
              <input type="text" name="cvv" class="form-control" placeholder="123">
            </div>
          </div>
        </div>

        <!-- PayNow Section -->
        <div id="paynowFields" style="display:none;">
          <div class="alert alert-info mt-3">
            <p class="mb-1"><strong>PayNow UEN:</strong> 123456789A</p>
            <p class="mb-0">Use your order ID as the payment reference.</p>
          </div>
        </div>

      </div>
    </div>

    <!-- Submit Button -->
    <div class="text-center mt-4">
      <button type="submit" class="btn btn-lg btn-primary px-5">Confirm Payment</button>
    </div>
  </form>

  <!-- Back Link -->
  <div class="text-center mt-3">
    <a href="/cart" class="text-decoration-none">‚Üê Back to Cart</a>
  </div>

</div>

</body>
</html>
